(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0adce468"],{"0cd9":function(e,t,o){var i=o("f772"),a=Math.floor;e.exports=function(e){return!i(e)&&isFinite(e)&&a(e)===e}},"2a24":function(e,t,o){},"3be2":function(e,t,o){e.exports=o("8790")},8516:function(e,t,o){var i=o("63b6");i(i.S,"Number",{isInteger:o("0cd9")})},8790:function(e,t,o){o("8516"),e.exports=o("584a").Number.isInteger},c3eb:function(e,t,o){"use strict";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.$root.showLoadingIcon,expression:"$root.showLoadingIcon"}],staticClass:"table"},[o("div",{staticClass:"crumbs"},[o("el-breadcrumb",{attrs:{separator:"/"}},[o("el-breadcrumb-item",[o("i",{staticClass:"el-icon-lx-cascades"}),e._v(" 套餐列表")])],1)],1),o("div",{staticClass:"container"},[o("div",{staticClass:"handle-box"},[o("el-select",{staticClass:"handle-select mr10",attrs:{placeholder:"上下架筛选"},model:{value:e.queryInfo.online,callback:function(t){e.$set(e.queryInfo,"online",t)},expression:"queryInfo.online"}},e._l(e.onlinTypes,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1),o("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"套餐名称筛选"},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query",t)},expression:"queryInfo.query"}}),o("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"菜品名称筛选"},model:{value:e.queryInfo.description,callback:function(t){e.$set(e.queryInfo,"description",t)},expression:"queryInfo.description"}}),o("el-button",{attrs:{type:"primary",icon:"search"},on:{click:e.getRawComboList}},[e._v("搜索")]),o("el-button",{staticClass:"handle-del mr10",attrs:{type:"primary",icon:"delete"},on:{click:e.handleAdd}},[e._v("新增套餐")])],1),o("el-table",{staticClass:"table",attrs:{data:e.data,border:""}},[o("el-table-column",{attrs:{prop:"index",label:"序号",width:"60",align:"center"}}),o("el-table-column",{attrs:{prop:"imgUrl",label:"图片",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[o("img",{staticStyle:{width:"100px",height:"60px"},attrs:{src:e.row.imgUrl,alt:"图片加载失败"}})]}}])}),o("el-table-column",{attrs:{prop:"cname",label:"名称",align:"center"}}),o("el-table-column",{attrs:{prop:"originPrice",label:"价格",sortable:"",align:"center"}}),o("el-table-column",{attrs:{prop:"stars",label:"好评度",align:"center"}}),o("el-table-column",{attrs:{prop:"sales",label:"销量",sortable:"",align:"center"}}),o("el-table-column",{attrs:{prop:"online",label:"状态",align:"center"}}),o("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(o){e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),"上架"==t.row.online?o("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(o){e.updateOnlineStatus(t.$index,t.row)}}},[e._v("下架")]):o("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(o){e.updateOnlineStatus(t.$index,t.row)}}},[e._v("上架")])]}}])})],1),o("div",{staticClass:"pagination"},[o("el-pagination",{attrs:{background:"","page-size":e.pageInfo.pageSize,layout:"prev, pager, next",total:e.pageInfo.totalData},on:{"current-change":e.pageChange}})],1)],1),o("el-dialog",{attrs:{title:"修改套餐",visible:e.editVisible,width:"30%"},on:{"update:visible":function(t){e.editVisible=t}}},[o("el-form",{ref:"editform",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[o("el-form-item",{attrs:{label:"套餐名称",prop:"cname"}},[o("el-input",{model:{value:e.form.cname,callback:function(t){e.$set(e.form,"cname",t)},expression:"form.cname"}})],1),o("el-form-item",{attrs:{label:"套餐价格",prop:"originPrice"}},[o("el-input",{attrs:{placeholder:"小数点后最多2位,单位为元"},model:{value:e.form.originPrice,callback:function(t){e.$set(e.form,"originPrice",t)},expression:"form.originPrice"}})],1),o("el-form-item",{attrs:{label:"销量",prop:"sales"}},[o("el-input",{attrs:{placeholder:"请输入正整数"},model:{value:e.form.sales,callback:function(t){e.$set(e.form,"sales",e._n(t))},expression:"form.sales"}})],1),o("el-form-item",{attrs:{label:"原图片"}},[o("img",{attrs:{src:e.form.imgUrl,alt:"呀,图片加载不出来",width:"200px",height:"200px"}})]),o("el-form-item",{attrs:{label:"套餐照片",prop:"img"}},[o("el-upload",{ref:"editUpload",staticClass:"upload-demo",attrs:{"list-type":"picture-card",accept:"image/*",headers:e.$root.headers,"with-credentials":e.withCredentials,action:e.editUrl,data:e.editData,limit:e.limit,name:e.fileName,"file-list":e.fileList,"on-error":e.editError,"on-success":e.editSuccess,"on-exceed":e.onExceed,"auto-upload":!1}},[o("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取图片")])],1)],1),o("el-form-item",{attrs:{label:"主食",prop:"mainFoodSelect"}},[o("el-select",{staticClass:"handle-select mr10",attrs:{placeholder:"选择主食"},model:{value:e.foodIds[0],callback:function(t){e.$set(e.foodIds,0,t)},expression:"foodIds[0]"}},e._l(e.mainFoodList,function(e,t){return o("el-option",{key:t,attrs:{label:e.fname,value:e.id}})}),1)],1),o("el-form-item",{attrs:{label:"辅食",prop:"assistFoodSelect"}},[o("el-select",{staticClass:"handle-select mr10",attrs:{placeholder:"选择辅食"},model:{value:e.foodIds[1],callback:function(t){e.$set(e.foodIds,1,t)},expression:"foodIds[1]"}},e._l(e.assistFoodList,function(e,t){return o("el-option",{key:t,attrs:{label:e.fname,value:e.id}})}),1)],1),o("el-form-item",{attrs:{label:"汤羹",prop:"soupFoodSelect"}},[o("el-select",{staticClass:"handle-select mr10",attrs:{placeholder:"选择汤羹"},model:{value:e.foodIds[2],callback:function(t){e.$set(e.foodIds,2,t)},expression:"foodIds[2]"}},e._l(e.soupList,function(e,t){return o("el-option",{key:t,attrs:{label:e.fname,value:e.id}})}),1)],1)],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("div",{staticClass:"footer-center"},[o("el-button",{on:{click:e.cancelEdit}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.editSubmit}},[e._v("提 交")])],1)])],1),o("el-dialog",{attrs:{title:"新增套餐",visible:e.addVisible,width:"30%"},on:{"update:visible":function(t){e.addVisible=t}}},[o("el-form",{ref:"addform",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[o("el-form-item",{attrs:{label:"套餐名称",prop:"cname"}},[o("el-input",{model:{value:e.form.cname,callback:function(t){e.$set(e.form,"cname",t)},expression:"form.cname"}})],1),o("el-form-item",{attrs:{label:"套餐价格",prop:"originPrice"}},[o("el-input",{attrs:{placeholder:"小数点后最多2位,单位为元"},model:{value:e.form.originPrice,callback:function(t){e.$set(e.form,"originPrice",t)},expression:"form.originPrice"}})],1),o("el-form-item",{attrs:{label:"销量",prop:"sales"}},[o("el-input",{attrs:{placeholder:"请输入正整数"},model:{value:e.form.sales,callback:function(t){e.$set(e.form,"sales",e._n(t))},expression:"form.sales"}})],1),o("el-form-item",{attrs:{label:"套餐照片",prop:"img"}},[o("el-upload",{ref:"addUpload",staticClass:"upload-demo",attrs:{"list-type":"picture-card",accept:"image/*",headers:e.$root.headers,"with-credentials":e.withCredentials,action:e.addUrl,data:e.addData,limit:e.limit,name:e.fileName,"file-list":e.fileList,"on-error":e.addError,"on-success":e.addSuccess,"on-exceed":e.onExceed,"auto-upload":!1}},[o("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取图片")])],1)],1),o("el-form-item",{attrs:{label:"主食",prop:"mainFoodSelect"}},[o("el-select",{staticClass:"handle-select mr10",attrs:{placeholder:"选择主食"},model:{value:e.foodIds[0],callback:function(t){e.$set(e.foodIds,0,t)},expression:"foodIds[0]"}},e._l(e.mainFoodList,function(e,t){return o("el-option",{key:t,attrs:{label:e.fname,value:e.id}})}),1)],1),o("el-form-item",{attrs:{label:"辅食",prop:"assistFoodSelect"}},[o("el-select",{staticClass:"handle-select mr10",attrs:{placeholder:"选择主食"},model:{value:e.foodIds[1],callback:function(t){e.$set(e.foodIds,1,t)},expression:"foodIds[1]"}},e._l(e.assistFoodList,function(e,t){return o("el-option",{key:t,attrs:{label:e.fname,value:e.id}})}),1)],1),o("el-form-item",{attrs:{label:"汤羹",prop:"soupFoodSelect"}},[o("el-select",{staticClass:"handle-select mr10",attrs:{placeholder:"选择主食"},model:{value:e.foodIds[2],callback:function(t){e.$set(e.foodIds,2,t)},expression:"foodIds[2]"}},e._l(e.soupList,function(e,t){return o("el-option",{key:t,attrs:{label:e.fname,value:e.id}})}),1)],1)],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("div",{staticClass:"footer-center"},[o("el-button",{on:{click:e.cancelAdd}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.addSubmit}},[e._v("提 交")])],1)])],1),o("el-dialog",{attrs:{title:"提示",visible:e.delVisible,width:"300px",center:""},on:{"update:visible":function(t){e.delVisible=t}}},[o("div",{staticClass:"del-dialog-cnt"},[e._v("确定要"+e._s(e.onlinTypes[e.needToChangeOnlineStatusCombo.online])+"该套餐吗？")]),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.delVisible=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.deleteRow}},[e._v("确 定")])],1)])],1)},a=[],s=(o("55dd"),o("3be2")),l=o.n(s),n={name:"basetable",data:function(){return{listUrl:"combo/listCombo",addUrl:"combo/addCombo",editUrl:"combo/updateCombo",delUrl:"combo/deleteCombo",listFoodUrl:"food/listFood",comboTypes:["主食","辅食","汤羹"],onlinTypes:["上架","下架"],combos:[],fileName:"file",fileList:[],limit:1,withCredentials:!0,addVisible:!1,editVisible:!1,delVisible:!1,queryInfo:{online:0,query:"",choosable:"",description:""},pageInfo:{pageNo:1,totalPage:1},validateOnRuleChange:!1,form:{choosable:!1},foodIds:[0,0,0],mainFoodList:[],assistFoodList:[],soupList:[],needToChangeOnlineStatusCombo:{online:1}}},created:function(){this.getRawComboList(),this.editUrl=this.$urlConfig.baseUrl+this.editUrl,this.addUrl=this.$urlConfig.baseUrl+this.addUrl},computed:{rules:function(){var e=this,t=function(t,o,i){0==e.$refs.addUpload.uploadFiles.length&&i(new Error("请上传照片")),i()},o=function(e,t,o){l()(t)?t<0&&o(new Error("必须大于等于0")):o(new Error("请输入数字值")),o()},i=function(t,o,i){0==e.foodIds[0]&&i(new Error("请选择主食")),i()},a=function(t,o,i){0==e.foodIds[1]&&i(new Error("请选择辅食")),i()},s=function(t,o,i){0==e.foodIds[2]&&i(new Error("请选择汤羹")),i()},n={cname:[{required:!0,message:"套餐名称必填",trigger:"blur"}],originPrice:[{required:!0,message:"价格必填",trigger:"blur"}],sales:[{validator:o}],mainFoodSelect:[{validator:i}],assistFoodSelect:[{validator:a}],soupFoodSelect:[{validator:s}]};return e.addVisible&&(n.img=[{validator:t}]),n},data:function(){var e=this;return e.combos.map(function(t,o){return{index:o+1,id:t.id,imgUrl:e.$util.getFullAttachmentUrl(t.imgUrl),cname:t.cname,originPrice:t.originPrice,choosable:e.comboTypes[t.choosable],online:e.onlinTypes[t.online],stars:t.stars,sales:t.sales,foodIds:t.foods.sort(function(e,t){return e.ftype-t.ftype}).map(function(e){return e.id})}})},editData:function(){var e=this;return{id:e.form.id,cname:e.form.cname,originPrice:e.form.originPrice,sales:e.form.sales,foodIds:e.foodIds}},addData:function(){var e=this;return{cname:e.form.cname,originPrice:e.form.originPrice,sales:e.form.sales,foodIds:e.foodIds}}},methods:{getRawComboList:function(){var e=this,t=e.assembleQueryUrl();e.$jsonAxios.get(t).then(function(t){var o=t.data;if(console.log(o),o.code==e.$util.success_code){e.combos=o.data.data;var i=o.data.page;e.pageInfo={pageNO:i.pageNO,pageSize:i.pageSize,totalData:i.totalData}}else e.$message.error("错误码："+o.code+" "+o.message)}).catch(function(t){console.log(t),e.$util.axiosErrorHandler(t,e)})},initMainAssistSoupFoods:function(){var e=this;if(!(e.mainFoodList.length>1)){var t=e.listFoodUrl+"?pageSize="+e.$util.maxPageSize;e.$jsonAxios.get(t).then(function(t){var o=t.data;e.$util.checkIfDataSuccess(o)?e.assembleMainAssistSoupFoodList(o):e.$message.error("错误码："+o.code+" "+o.message)}).catch(function(t){console.log(t),e.$util.axiosErrorHandler(t,e)})}},assembleMainAssistSoupFoodList:function(e){var t=this,o={id:0,fname:"请选择"};try{var i=e.data.data,a=i.filter(function(e){return 0==e.ftype});a.unshift(o),t.mainFoodList=a,a=i.filter(function(e){return 1==e.ftype}),a.unshift(o),t.assistFoodList=a,a=i.filter(function(e){return 2==e.ftype}),a.unshift(o),t.soupList=a}catch(s){t.$message.error("初始化菜品列表失败")}},assembleQueryUrl:function(){var e=this.pageInfo,t=this.queryInfo,o={};return this.$util.assembleNewParamsWithNoUndefinedNullProperty(o,e),this.$util.assembleNewParamsWithNoUndefinedNullProperty(o,t),this.listUrl+"?"+this.$qs.stringify(o)},handleAdd:function(){var e=this;e.initMainAssistSoupFoods(),e.fileList=[],e.form={online:0},e.addVisible=!0,e.$nextTick(function(){e.$refs.addform.clearValidate()})},handleEdit:function(e,t){var o=this;o.initMainAssistSoupFoods(),o.idx=e;var i=o.data[e];o.form={id:i.id,cname:i.cname,originPrice:i.originPrice,online:o.onlinTypes.indexOf(i.online),imgUrl:i.imgUrl,sales:i.sales},o.foodIds=i.foodIds,o.fileList=[],o.editVisible=!0,o.$nextTick(function(){o.$refs.editform.clearValidate()})},updateOnlineStatus:function(e,t){var o=this.onlinTypes.indexOf(t.online);o=-1==o?0:o,o=Math.abs(o-1),this.needToChangeOnlineStatusCombo.idx=e,this.needToChangeOnlineStatusCombo.id=t.id,this.needToChangeOnlineStatusCombo.online=o,this.delVisible=!0},addSubmit:function(){var e=this;e.$refs.addform.validate(function(t,o){1==t&&(console.log(e.$refs.addUpload.data),e.$refs.addUpload.submit())})},editSubmit:function(){var e=this;e.$refs.editform.validate(function(t,o){t&&(1==e.$refs.editUpload.uploadFiles.length?e.$refs.editUpload.submit():e.editSubmitByHand())})},editSubmitByHand:function(){var e=this;e.$jsonAxios.post(e.editUrl,e.$qs.stringify(e.editData)).then(function(t){var o=t.data;e.$util.checkIfDataSuccess(o)?e.$message.success("修改成功！"):e.$message.error("错误码："+o.code+" "+o.message),e.getRawComboList(),e.editVisible=!1}).catch(function(t){e.$util.axiosErrorHandler(t,e)})},deleteRow:function(){var e=this;e.$jsonAxios.post(e.delUrl,e.$qs.stringify(e.needToChangeOnlineStatusCombo)).then(function(t){var o=t.data;if(o.code==e.$util.success_code){e.combos.splice(e.needToChangeOnlineStatusCombo.idx,1);var i=e.onlinTypes[e.needToChangeOnlineStatusCombo.online];e.$message.success(i+"成功")}else e.$message.error("错误码："+o.code+" "+o.message);e.delVisible=!1}).catch(function(t){e.$util.axiosErrorHandler(t)})},cancelAdd:function(){this.addVisible=!1},cancelEdit:function(){this.editVisible=!1},pageChange:function(e){this.pageInfo.pageNo=e,this.getRawComboList()},editSuccess:function(e,t,o){var i=this;i.$util.checkIfDataSuccess(e)?(i.$message.success("修改成功!"),i.getRawComboList(),i.editVisible=!1):i.editError()},editError:function(e,t,o){this.$message.error("修改失败!")},addSuccess:function(e,t,o){var i=this;i.$util.checkIfDataSuccess(e)?(i.$message.success("新增成功!"),i.getRawComboList(),i.addVisible=!1):i.addError()},addError:function(e,t,o){this.$message.error("新增失败!")},onExceed:function(){this.$message.error("最多上传一张,请先删除左边的轮播图")}}},r=n,d=(o("fef0"),o("2877")),c=Object(d["a"])(r,i,a,!1,null,"5d6b0507",null);c.options.__file="combo-list.vue";t["default"]=c.exports},fef0:function(e,t,o){"use strict";var i=o("2a24"),a=o.n(i);a.a}}]);